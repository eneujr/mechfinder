{% extends "base.html" %}

{% block title %}Relatórios PDV - MechFinder{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
        <h2><i class="fas fa-cash-register me-2"></i>Relatórios de Ponto de Venda</h2>
        <div class="btn-group">
            <button class="btn btn-secondary" onclick="exportarCSV()">
                <i class="fas fa-file-csv me-2"></i>Exportar CSV
            </button>
            <button class="btn btn-primary" onclick="imprimirRelatorio()">
                <i class="fas fa-print me-2"></i>Imprimir
            </button>
        </div>
    </div>
</div>

<!-- Filtros de Período -->
<div class="card mb-4">
    <div class="card-body">
        <form class="row g-3 align-items-end">
            <div class="col-md-4">
                <label for="dataInicio" class="form-label text-gold">Data Início</label>
                <input type="date" class="form-control" id="dataInicio">
            </div>
            <div class="col-md-4">
                <label for="dataFim" class="form-label text-gold">Data Fim</label>
                <input type="date" class="form-control" id="dataFim">
            </div>
            <div class="col-md-4">
                <button type="button" class="btn btn-primary w-100" onclick="filtrarRelatorio()">
                    <i class="fas fa-filter me-2"></i>Filtrar Dados
                </button>
            </div>
        </form>
    </div>
</div>

<!-- KPIs (Key Performance Indicators) -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center h-100">
            <div class="card-body">
                <h6 class="text-muted text-uppercase">Vendas Hoje</h6>
                <h3 class="text-gold mb-0">R$ 1.250,00</h3>
                <small class="text-success"><i class="fas fa-arrow-up"></i> 15% vs ontem</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center h-100">
            <div class="card-body">
                <h6 class="text-muted text-uppercase">Ticket Médio</h6>
                <h3 class="text-gold mb-0">R$ 185,50</h3>
                <small class="text-muted"><i class="fas fa-minus"></i> Estável</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center h-100">
            <div class="card-body">
                <h6 class="text-muted text-uppercase">Produtos Vendidos</h6>
                <h3 class="text-gold mb-0">42</h3>
                <small class="text-success"><i class="fas fa-arrow-up"></i> 8% vs média</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center h-100">
            <div class="card-body">
                <h6 class="text-muted text-uppercase">Lucro Estimado</h6>
                <h3 class="text-gold mb-0">R$ 450,00</h3>
                <small class="text-danger"><i class="fas fa-arrow-down"></i> Margem baixa</small>
            </div>
        </div>
    </div>
</div>

<!-- Gráficos Principais -->
<div class="row mb-4">
    <div class="col-md-8">
        <div class="card h-100">
            <div class="card-header">
                <i class="fas fa-chart-line me-2"></i>Desempenho de Vendas (Hora a Hora)
            </div>
            <div class="card-body">
                <canvas id="vendasHoraChart" height="300"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header">
                <i class="fas fa-wallet me-2"></i>Métodos de Pagamento
            </div>
            <div class="card-body">
                <canvas id="pagamentosChart" height="300"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Tabela de Transações Recentes -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span><i class="fas fa-list me-2"></i>Transações Recentes</span>
        <a href="#" class="btn btn-sm btn-outline-primary">Ver Todas</a>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Hora</th>
                        <th>Cliente</th>
                        <th>Itens</th>
                        <th>Total</th>
                        <th>Pagamento</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>#1024</td>
                        <td>14:30</td>
                        <td>João Silva</td>
                        <td>3</td>
                        <td>R$ 450,00</td>
                        <td>Crédito</td>
                        <td><span class="badge bg-success">Aprovado</span></td>
                    </tr>
                    <tr>
                        <td>#1023</td>
                        <td>14:15</td>
                        <td>Maria Oliveira</td>
                        <td>1</td>
                        <td>R$ 120,00</td>
                        <td>Pix</td>
                        <td><span class="badge bg-success">Aprovado</span></td>
                    </tr>
                    <tr>
                        <td>#1022</td>
                        <td>13:45</td>
                        <td>Carlos Santos</td>
                        <td>5</td>
                        <td>R$ 890,50</td>
                        <td>Débito</td>
                        <td><span class="badge bg-success">Aprovado</span></td>
                    </tr>
                    <tr>
                        <td>#1021</td>
                        <td>13:30</td>
                        <td>Ana Costa</td>
                        <td>2</td>
                        <td>R$ 210,00</td>
                        <td>Dinheiro</td>
                        <td><span class="badge bg-warning">Pendente</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Configuração de cores do tema
        const themeColors = {
            gold: '#d4af37',
            copper: '#b87333',
            bronze: '#cd7f32',
            accent: '#ff4500',
            text: '#e0e0e0',
            grid: '#333'
        };

        // Gráfico de Vendas por Hora
        const ctxVendas = document.getElementById('vendasHoraChart').getContext('2d');
        new Chart(ctxVendas, {
            type: 'line',
            data: {
                labels: ['08:00', '10:00', '12:00', '14:00', '16:00', '18:00'],
                datasets: [{
                    label: 'Vendas Hoje',
                    data: [150, 450, 320, 580, 420, 600],
                    borderColor: themeColors.gold,
                    backgroundColor: 'rgba(212, 175, 55, 0.1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: themeColors.text } }
                },
                scales: {
                    y: {
                        grid: { color: themeColors.grid },
                        ticks: { color: themeColors.text }
                    },
                    x: {
                        grid: { color: themeColors.grid },
                        ticks: { color: themeColors.text }
                    }
                }
            }
        });

        // Gráfico de Pagamentos
        const ctxPagamentos = document.getElementById('pagamentosChart').getContext('2d');
        new Chart(ctxPagamentos, {
            type: 'doughnut',
            data: {
                labels: ['Crédito', 'Débito', 'Pix', 'Dinheiro'],
                datasets: [{
                    data: [45, 25, 20, 10],
                    backgroundColor: [
                        themeColors.gold,
                        themeColors.copper,
                        themeColors.bronze,
                        themeColors.accent
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: themeColors.text }
                    }
                }
            }
        });
    });

    function filtrarRelatorio() {
        alert('Funcionalidade de filtro em desenvolvimento.');
    }

    function exportarCSV() {
        alert('Exportando dados para CSV...');
    }

    function imprimirRelatorio() {
        window.print();
    }
</script>
{% endblock %}